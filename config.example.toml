# -*- coding: utf-8 -*-
# CM-performance-optimizer-plugin 配置示例
# 
# 使用说明：
# 1. 复制此文件为 config.toml
# 2. 根据实际需求修改配置项
# 3. 所有配置项都有默认值，无需全部填写
#
# 注意：
# - 配置支持热更新（标记为 hot_reload 的项可在运行时修改）
# - 修改配置后无需重启 MaiBot

# ================================
# 插件基础配置
# ================================
[plugin]
# 是否启用插件
enabled = true

# 配置文件版本（请勿修改）
config_version = "2.0.0"

# 日志级别: DEBUG, INFO, WARNING, ERROR, CRITICAL
log_level = "INFO"

# ================================
# 性能模块开关
# ================================
[performance]
# 消息缓存 - 缓存历史消息，加速查询
enable_message_cache = true

# 消息仓库快速路径 - count_messages 快速计数缓存
enable_message_repository_fastpath = true

# 人物信息缓存 - 缓存人物设定信息
enable_person_cache = true

# 表达式缓存 - 缓存表达式解析结果
enable_expression_cache = true

# 黑话缓存 - 缓存黑话/术语解释
enable_jargon_cache = true

# 黑话匹配自动机 - Aho-Corasick 算法加速匹配
enable_jargon_matcher_automaton = true

# 知识图谱缓存 - 缓存知识库图谱数据
enable_kg_cache = true

# Levenshtein 距离加速 - rapidfuzz 加速编辑距离计算
enable_levenshtein_fast = true

# 图片描述批量查询 - 批量查询图片描述
enable_image_desc_bulk_lookup = true

# 用户引用批量解析 - @用户/回复 引用解析缓存
enable_user_reference_batch_resolve = true

# 正则预编译 - 预编译高频正则表达式
enable_regex_precompile = true

# 拼写错误生成器缓存 - 拼音词典和有效词缓存
enable_typo_generator_cache = true

# 轻量性能剖析 - 性能监控（默认关闭）
enable_lightweight_profiler = false

# 性能剖析采样率 (0.0 - 1.0)
profiler_sample_rate = 0.1

# SQLite 数据库调优 - PRAGMA 优化和索引检查
enable_db_tuning = true

# SQLite mmap 大小（字节，0=禁用）
db_mmap_size = 268435456

# WAL checkpoint 周期（秒，0=禁用）
db_wal_checkpoint_interval = 300

# 异步循环池 - embedding 工作线程复用
enable_asyncio_loop_pool = true

# ================================
# 模块详细配置
# ================================

# 消息缓存配置
[modules.message_cache]
enabled = true
# 每个聊天的缓存消息数量 (50-1000)
per_chat_limit = 200
# 缓存过期时间（秒）(60-3600)
ttl = 300
# 最大缓存聊天数 (10-2000)
max_chats = 500
# 缓存模式: "query" 或 "full"
# - query: 仅缓存查询过的消息
# - full: 缓存所有消息（占用更多内存）
mode = "query"

# 人物信息缓存配置
[modules.person_cache]
enabled = true
# 最大缓存条目数 (100-5000)
max_size = 1000
# 缓存过期时间（秒）(60-7200)
ttl = 600

# 表达式缓存配置
[modules.expression_cache]
enabled = true
# 最大缓存条目数 (100-10000)
max_size = 2000
# 批量写入大小
batch_size = 100

# 黑话缓存配置
[modules.jargon_cache]
enabled = true
# 最大缓存条目数 (100-5000)
max_size = 1000
# 批量写入大小
batch_size = 50

# 知识图谱缓存配置
[modules.kg_cache]
enabled = true
# 最大缓存条目数 (100-10000)
max_size = 2000
# 批量写入大小
batch_size = 100
# 是否启用 Parquet 格式存储
use_parquet = true

# ================================
# 高级配置
# ================================
[advanced]
# 启用配置热更新
enable_hot_reload = true

# 配置验证严格模式
strict_validation = false

# 启用配置变更通知
enable_change_notifications = true

# ================================
# 监控配置
# ================================
[monitoring]
# 启用监控指标收集
enable_metrics = true

# 指标上报间隔（秒）
metrics_interval = 60

# 启用健康检查
enable_health_check = true

# 健康检查间隔（秒）
health_check_interval = 30
