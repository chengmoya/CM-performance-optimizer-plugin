# CM-performance-optimizer - 配置文件
# 性能优化插件 - 让机器人跑得更快更流畅
# 配置版本: 6.1.0

# ========== 插件基础设置 ==========
[plugin]

# 是否启用这个插件
# 作用：开关整个插件，关闭后所有优化功能都不生效
# 建议：一般保持开启
enabled = true

# 配置文件版本（不要改动）
config_version = "6.1.0"

# 日志级别
# 作用：控制插件输出多少日志信息
# 可选值：
#   "DEBUG"   - 最详细：会输出所有调试信息，日志很多，适合排查问题时用
#   "INFO"    - 普通：会输出正常运行信息，推荐日常使用
#   "WARNING" - 警告：只输出警告和错误，信息较少
#   "ERROR"   - 错误：只输出错误信息
# 建议：日常使用设为"INFO"，遇到问题需要排查时设为"DEBUG"
log_level = "INFO"

# ========== 功能模块开关 ==========
# 这部分控制每个优化功能是否开启

[modules]

# 【消息缓存】
# 作用：把聊天记录临时存到内存里，这样机器人回复时不用每次都去翻数据库
# 效果：开启后机器人回复更快，但会多用一些内存
# 建议：建议开启，这是最常用的优化功能
message_cache_enabled = true

# 【消息仓库快速通道】
# 作用：优化消息查询的内部流程，让查消息更快
# 效果：对查询速度有提升，但效果不如消息缓存明显
# 建议：建议开启，一般和消息缓存一起配合使用
message_repository_fastpath_enabled = true

# 【人物信息缓存】
# 作用：把群成员信息（昵称、名片等）存到内存里
# 效果：查人更快，不用每次都去数据库翻
# 建议：建议开启，特别是群成员多的时候效果明显
person_cache_enabled = true

# 【表达式缓存】
# 作用：把机器人回复的表达式规则存到内存里
# 效果：匹配回复更快，新手审核也更快
# 建议：建议开启，对审核速度有明显提升
expression_cache_enabled = true

# 【黑话缓存】
# 作用：把圈子里特有的说话方式/暗语存到内存里
# 效果：识别黑话更快
# 建议：如果你的群有特殊用语或黑话，建议开启
jargon_cache_enabled = true

# 【黑话匹配加速】
# 作用：用更快的算法来匹配黑话
# 效果：识别速度更快，但效果不如黑话缓存本身明显
# 建议：建议开启，配合黑话缓存使用效果更好
jargon_matcher_automaton_enabled = true

# 【知识图谱缓存】
# 作用：把知识库的内容存到内存里
# 效果：回答知识库相关的问题更快
# 建议：如果你使用知识库功能，建议开启
kg_cache_enabled = true

# 【编辑距离加速】
# 作用：用更快的方法计算字符串相似度，用于模糊匹配
# 效果：处理typo（输错的字）更快
# 建议：建议开启，能提升用户体验
levenshtein_fast_enabled = true

# 【图片描述批量替换】
# 作用：批量处理图片描述的替换
# 效果：处理图片消息更快
# 建议：如果群里经常发图片，建议开启
image_desc_bulk_lookup_enabled = true

# 【用户引用批量解析】
# 作用：批量处理@用户的引用
# 效果：处理引用更快
# 建议：建议开启
user_reference_batch_resolve_enabled = true

# 【正则表达式预编译】
# 作用：提前把常用的正则表达式准备好，用的时候直接调用
# 效果：匹配文本更快，不用每次现算
# 建议：建议开启
regex_precompile_enabled = true

# 【纠错生成器缓存】
# 作用：把常见的输入错误存起来，下次直接用
# 效果：处理typo更快
# 建议：建议开启
typo_generator_cache_enabled = true

# 【数据库调优】
# 作用：优化SQLite数据库的内部设置，让读写更快
# 效果：整体性能提升，特别是数据库操作多的场景
# 建议：建议开启，这个优化是永久性的
db_tuning_enabled = true

# 【性能剖析】
# 作用：记录每个操作花了多长时间
# 效果：能帮你找到哪个功能最慢，但会轻微影响性能
# 建议：日常使用可以关闭，需要排查问题时开启
lightweight_profiler_enabled = true

# ========== 消息缓存详细配置 ==========
# 控制消息缓存的具体行为

[message_cache]

# 【缓存模式】
# 作用：决定缓存多少消息
# 可选值：
#   "query" - 轻量模式：只缓存最近查过的消息，内存占用小
#   "full"  - 完整模式：把整个数据库都加载到内存，速度最快但非常吃内存
# 效果：
#   query模式：内存占用约100-500MB，适合大多数服务器
#   full模式：内存占用可能达到1-4GB，需要大内存服务器
# 建议：一般用query就够了，除非你的服务器内存很大且群特别活跃
mode = "query"

# 【每个群的缓存消息数】
# 作用：每个群/私聊最多缓存多少条消息
# 效果：
#   值越大 = 能缓存更多历史消息，回复更快，但占用更多内存
#   值越小 = 节省内存，但可能需要更频繁查数据库
# 举例：设为200，意味着每个群最多缓存200条消息
# 建议：一般100-300够用了，太大了内存压力大
per_chat_limit = 100

# 【缓存过期时间】
# 作用：消息缓存保存多长时间后会失效
# 效果：
#   时间越长 = 缓存越持久，重复查询更快，但可能不够及时
#   时间越短 = 数据更新更及时，但重复查询时要去数据库
# 举例：设为300秒（5分钟），意味着5分钟前的消息可能会被清理
# 建议：一般300秒（5分钟）就够了，太长可能导致数据不及时
ttl = 300

# 【最多缓存多少个群】
# 作用：最多同时缓存多少个群的聊天记录
# 效果：
#   值越大 = 能缓存更多群的消息，但占用更多内存
#   值越小 = 节省内存，但有些群的消息可能不会被缓存
# 建议：一般500够用了，如果你有很多大群可以调大
max_chats = 500

# 【活跃群是否忽略过期时间】
# 作用：正在聊天的群是否不受缓存过期时间限制
# 效果：
#   开启 = 活跃的群消息会一直缓存，直到群不活跃
#   关闭 = 活跃的群也会按过期时间清理
# 建议：建议开启，这样活跃的群回复会更快
ignore_time_limit_when_active = true

# 【活跃时间窗口】
# 作用：多长时间没消息算"不活跃"
# 效果：
#   时间越长 = 群会被认为活跃更久，缓存保留更久
#   时间越短 = 不活跃的群会更快清理缓存
# 举例：设为300秒（5分钟），如果5分钟内群里没消息，就算不活跃
# 建议：一般300秒（5分钟）就够了
active_time_window = 300

# 【滑动窗口分桶功能】
# 作用：更精细地管理缓存，按时间分段存储
# 效果：更精准地控制缓存，但实现复杂
# 建议：一般用户不需要开启
bucket_enabled = false

# 【分桶时间间隔】
# 作用：每个分桶代表多长时间
# 效果：间隔越小，分桶越多，管理越精细，但开销越大
# 建议：一般5秒就够了
bucket_seconds = 5

# ========== 人物信息缓存配置 ==========
# 控制群成员信息的缓存

[person_cache]

# 【最大缓存人数】
# 作用：最多缓存多少人的信息
# 效果：
#   值越大 = 能缓存更多人的信息，查起来更快，但占用更多内存
#   值越小 = 节省内存，但频繁查数据库
# 举例：设为3000，意味着最多缓存3000个人的信息
# 建议：一般3000够用了，如果群很大可以调大
max_size = 3000

# 【缓存过期时间】
# 作用：人物信息缓存保存多长时间
# 效果：
#   时间越长 = 不需要频繁刷新，但可能信息不及时
#   时间越短 = 信息更及时，但查得更频繁
# 建议：一般1800秒（30分钟）就够了
ttl = 1800

# 【预热功能】
# 作用：开机时自动加载常用群成员的信息
# 效果：
#   开启 = 启动后很快就能快速响应
#   关闭 = 第一次查人时会慢一些
# 建议：建议开启
warmup_enabled = true

# 【预热采样数量】
# 作用：预热时每个群最多采多少条消息来分析成员
# 效果：
#   值越大 = 能识别更多成员，但预热更慢
#   值越小 = 预热更快，但可能漏掉一些成员
# 建议：一般50条就够了
warmup_per_chat_sample = 50

# 【预热最多人数】
# 作用：预热时每个群最多加载多少人的信息
# 效果：
#   值越大 = 每个群加载更多人，但预热更慢
#   值越小 = 预热更快
# 建议：一般20人够了
warmup_max_persons = 20

# 【预热记录有效期】
# 作用：预热的信息保存多久
# 效果：超过这个时间，下次还会重新预热
# 建议：一般120秒（2分钟）就够了
warmup_ttl = 120

# 【预热防抖时间】
# 作用：收到新消息后多久才开始预热
# 效果：避免频繁触发预热，节省资源
# 建议：一般3秒就够了
warmup_debounce_seconds = 3

# ========== 表达式缓存配置 ==========
# 控制表达式（回复规则）的缓存

[expression_cache]

# 【批量处理大小】
# 作用：每次处理多少条表达式
# 效果：
#   值越大 = 处理更快，但可能一時占用更多资源
#   值越小 = 更平滑，但处理更慢
# 建议：一般100就够了
batch_size = 100

# 【批量处理延迟】
# 作用：每批处理之间等待多长时间
# 效果：
#   时间越长 = 对系统压力更小，但更新更慢
#   时间越短 = 更新更快，但可能占用更多资源
# 建议：一般0.05秒（50毫秒）就够了
batch_delay = 0.05

# 【刷新间隔】
# 作用：多长时间更新一次表达式缓存
# 效果：
#   时间越长 = 更新更少，更省资源，但新表达式生效慢
#   时间越短 = 更新更频繁，新表达式生效快，但更费资源
# 建议：一般3600秒（1小时）就够了
refresh_interval = 3600

# 【增量刷新间隔】
# 作用：多长时间检查一次是否有小更新
# 效果：比完全刷新更轻量
# 建议：一般600秒（10分钟）就够了
incremental_refresh_interval = 600

# 【增量刷新阈值】
# 作用：变化多少比例时才触发增量刷新
# 效果：
#   比例越小 = 更容易触发刷新，更及时
#   比例越大 = 更省资源，但可能不够及时
# 建议：一般0.1（10%）就够了
incremental_threshold_ratio = 0.1

# 【完全重建间隔】
# 作用：多长时间完全重建一次缓存
# 效果：完全重建会更彻底，但更耗时
# 建议：一般86400秒（1天）就够了
full_rebuild_interval = 86400

# 【删除检查间隔】
# 作用：多长时间检查一次是否有要删除的表达式
# 效果：间隔越小，删除越及时
# 建议：一般100秒就够了
deletion_check_interval = 100

# ========== 黑话缓存配置 ==========
# 控制黑话（特殊用语）的缓存

[jargon_cache]

# 【批量处理大小】
# 作用：每次处理多少条黑话
# 建议：一般100就够了
batch_size = 100

# 【批量处理延迟】
# 作用：每批处理之间等待多长时间
# 建议：一般0.05秒（50毫秒）就够了
batch_delay = 0.05

# 【刷新间隔】
# 作用：多长时间更新一次黑话缓存
# 建议：一般3600秒（1小时）就够了
refresh_interval = 3600

# 【内容索引】
# 作用：建立索引来加速搜索
# 效果：开启后搜索更快
# 建议：建议开启
enable_content_index = true

# 【增量刷新间隔】
# 作用：多长时间检查一次是否有小更新
# 建议：一般600秒（10分钟）就够了
incremental_refresh_interval = 600

# 【增量刷新阈值】
# 作用：变化多少比例时才触发增量刷新
# 建议：一般0.1（10%）就够了
incremental_threshold_ratio = 0.1

# 【完全重建间隔】
# 作用：多长时间完全重建一次缓存
# 建议：一般86400秒（1天）就够了
full_rebuild_interval = 86400

# 【删除检查间隔】
# 作用：多长时间检查一次是否有要删除的黑话
# 建议：一般100秒就够了
deletion_check_interval = 100

# ========== 知识图谱缓存配置 ==========
# 控制知识库的缓存

[kg_cache]

# 【批量处理大小】
# 作用：每次处理多少条知识
# 建议：一般100就够了
batch_size = 100

# 【批量处理延迟】
# 作用：每批处理之间等待多长时间
# 建议：一般0.05秒（50毫秒）就够了
batch_delay = 0.05

# 【刷新间隔】
# 作用：多长时间更新一次知识库缓存
# 建议：一般3600秒（1小时）就够了
refresh_interval = 3600

# 【增量刷新间隔】
# 作用：多长时间检查一次是否有小更新
# 建议：一般600秒（10分钟）就够了
incremental_refresh_interval = 600

# 【增量刷新阈值】
# 作用：变化多少比例时才触发增量刷新
# 建议：一般0.1（10%）就够了
incremental_threshold_ratio = 0.1

# 【完全重建间隔】
# 作用：多长时间完全重建一次缓存
# 建议：一般86400秒（1天）就够了
full_rebuild_interval = 86400

# 【删除检查间隔】
# 作用：多长时间检查一次是否有要删除的知识
# 建议：一般100秒就够了
deletion_check_interval = 100

# 【使用Parquet格式】
# 作用：使用更高效的存储格式
# 效果：开启后读写更快
# 建议：建议开启
use_parquet = true

# ========== 数据库调优配置 ==========
# 控制SQLite数据库的性能优化

[db_tuning]

# 【内存映射大小】
# 作用：用内存来加速数据库读写
# 效果：
#   值越大 = 读写更快，但占用更多内存
#   值越小 = 更省内存，但读写更慢
# 举例：设为268435456字节（256MB），意味着用256MB内存来加速
# 建议：一般256MB够了，内存大的服务器可以调大
mmap_size = 268435456

# 【WAL检查点间隔】
# 作用：多长时间把写日志合并到主数据库
# 效果：
#   时间越长 = 写入更快，但断电可能丢失更多数据
#   时间越短 = 数据更安全，但写入稍慢
# 建议：一般300秒（5分钟）够了，这是安全和性能的平衡点
wal_checkpoint_interval = 300

# ========== 性能剖析配置 ==========
# 控制性能记录功能

[lightweight_profiler]

# 【采样率】
# 作用：记录多少比例的操作
# 效果：
#   值越大 = 记录更详细，但更影响性能
#   值越小 = 对性能影响小，但记录不详细
# 举例：设为0.2（20%），意味着记录20%的操作
# 建议：一般0.2（20%）就够了，需要更详细信息可以调大
sample_rate = 0.2

# ========== 高级设置 ==========
# 一些高级优化选项

[advanced]

# 【异步IO】
# 作用：让IO操作不阻塞，提高并发能力
# 效果：开启后能同时处理更多请求
# 建议：建议开启
enable_async_io = true

# 【orjson加速】
# 作用：使用更快的JSON处理库
# 效果：JSON解析和生成更快
# 建议：建议开启
enable_orjson = true

# 【配置热重载】
# 作用：修改配置后不用重启就能生效
# 效果：调整配置更方便
# 建议：建议开启
enable_hot_reload = true

# 【严格验证】
# 作用：更严格地检查配置是否正确
# 效果：开启后配置错误会被拒绝，但可能影响启动速度
# 建议：一般关闭，需要排查配置问题时可以开启
strict_validation = false

# 【配置变更通知】
# 作用：配置变更时通知相关模块
# 效果：确保各模块及时更新配置
# 建议：建议开启
enable_change_notifications = true

# ========== 监控设置 ==========
# 控制统计和监控功能

[monitoring]

# 【启用统计】
# 作用：记录各种操作次数和时间
# 效果：能了解插件运行状况，但会轻微影响性能
# 建议：建议开启
enable_stats = true

# 【统计间隔】
# 作用：多长时间输出一次统计信息
# 效果：间隔越短，信息越及时
# 建议：一般60秒（1分钟）就够了
stats_interval = 60

# 【启用内存监控】
# 作用：监控内存使用情况
# 效果：能及时发现内存问题
# 建议：建议开启
enable_memory_monitor = true

# 【内存警告阈值】
# 作用：内存使用多少时发出警告
# 效果：
#   值越小 = 更早发出警告，更安全
#   值越大 = 更晚警告，可能不及时
# 举例：设为0.2（20%），意味着剩余内存低于20%时警告
# 建议：一般0.2（20%）就够了
memory_warning_threshold = 0.2

# 【内存严重阈值】
# 作用：内存使用多少时发出严重警告
# 效果：
#   值越小 = 更早发现严重问题
#   值越大 = 更晚发现
# 举例：设为0.5（50%），意味着剩余内存低于50%时严重警告
# 建议：一般0.5（50%）就够了
memory_critical_threshold = 0.5

# 【启用健康检查】
# 作用：定期检查插件是否正常工作
# 效果：能及时发现问题
# 建议：建议开启
enable_health_check = true

# 【健康检查间隔】
# 作用：多长时间检查一次健康状态
# 效果：间隔越短，问题发现越快
# 建议：一般60秒（1分钟）就够了
health_check_interval = 60

# ========== 通知设置 ==========
# 控制各种通知功能

[notification]

# 【启用通知】
# 作用：开启后会把重要信息发给管理员
# 效果：能及时知道发生了什么问题
# 建议：建议开启
enabled = true

# 【管理员QQ号】
# 作用：接收通知的QQ号码
# 说明：填你的QQ号，这样插件就会给你发消息
# 注意：留空就不发送QQ通知
admin_qq = "645710451"
